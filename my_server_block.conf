server {
  listen                               8080;
  server_name                          jerome.mac-lean.com jerome-preprod.mac-lean.com local-jerome.mac-lean.com;

  location / {
    resolver                           127.0.0.1 valid=5s;
    proxy_pass                         http://maclean:8080;
    proxy_http_version                 1.1;
    proxy_cache_bypass                 $http_upgrade;

    proxy_set_header Upgrade           $http_upgrade;
    proxy_set_header Connection        "upgrade";
    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host  $host;
    proxy_set_header X-Forwarded-Port  $server_port;
  }
}

server {
  listen                               8080;
  server_name                          www.crosslogic-consulting.com crosslogic-consulting.com www-preprod.crosslogic-consulting.com local-www.crosslogic-consulting.com;

  location / {
    resolver                           127.0.0.1 valid=5s;
    proxy_pass                         http://crosslogic:8080;
    proxy_http_version                 1.1;
    proxy_cache_bypass                 $http_upgrade;

    proxy_set_header Upgrade           $http_upgrade;
    proxy_set_header Connection        "upgrade";
    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host  $host;
    proxy_set_header X-Forwarded-Port  $server_port;
  }
}

server {
  listen                               8443 ssl;
  server_name                          jerome.mac-lean.com jerome-preprod.mac-lean.com local-jerome.mac-lean.com;

  ssl_certificate                      /opt/bitnami/nginx/conf/server_blocks/ssl/certs/mac-lean.com-fullchain.crt;
  ssl_certificate_key                  /opt/bitnami/nginx/conf/server_blocks/ssl/certs/mac-lean.com-private.key;
  ssl_trusted_certificate              /opt/bitnami/nginx/conf/server_blocks/ssl/certs/mac-lean.com-chain.crt;
  ssl_dhparam                          /opt/bitnami/nginx/conf/server_blocks/ssl/certs/mac-lean.com-dhparam.pem;
  ssl_session_cache                    builtin:1000  shared:SSL:10m;
  ssl_protocols                        TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers                          HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;
  ssl_prefer_server_ciphers            on;

  location / {
    resolver                           127.0.0.1 valid=5s;
    proxy_pass                         https://maclean:8443;
    proxy_http_version                 1.1;
    proxy_cache_bypass                 $http_upgrade;

    proxy_set_header Upgrade           $http_upgrade;
    proxy_set_header Connection        "upgrade";
    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host  $host;
    proxy_set_header X-Forwarded-Port  $server_port;
  }
}

server {
  listen                               8443 ssl;
  server_name                          www.crosslogic-consulting.com crosslogic-consulting.com www-preprod.crosslogic-consulting.com local-www.crosslogic-consulting.com;

  ssl_certificate                      /opt/bitnami/nginx/conf/server_blocks/ssl/certs/crosslogic-consulting.com-fullchain.crt;
  ssl_certificate_key                  /opt/bitnami/nginx/conf/server_blocks/ssl/certs/crosslogic-consulting.com-private.key;
  ssl_trusted_certificate              /opt/bitnami/nginx/conf/server_blocks/ssl/certs/crosslogic-consulting.com-chain.crt;
  ssl_dhparam                          /opt/bitnami/nginx/conf/server_blocks/ssl/certs/crosslogic-consulting.com-dhparam.pem;
  ssl_session_cache                    builtin:1000  shared:SSL:10m;
  ssl_protocols                        TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers                          HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;
  ssl_prefer_server_ciphers            on;

  location / {
    resolver                           127.0.0.1 valid=5s;
    proxy_pass                         https://crosslogic:8443;
    proxy_http_version                 1.1;
    proxy_cache_bypass                 $http_upgrade;

    proxy_set_header Upgrade           $http_upgrade;
    proxy_set_header Connection        "upgrade";
    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host  $host;
    proxy_set_header X-Forwarded-Port  $server_port;
  }
}
