apiVersion: v1
kind: Pod
spec:
  serviceAccountName: jenkins
  containers:

  # OpenShift/Jenkins Base Container
  - name: jnlp
    image: openshift/jenkins-slave-base-centos7:v3.11
    command:
    - /bin/sh
    args:
    - -c
    - umask 0000; /usr/local/bin/run-jnlp-client ${JENKINS_SECRET} ${JENKINS_NAME}
    resources:
      limits:
        memory: 256Mi
    workingDir: /home/jenkins
    env:
    - name: JNLP_MAX_HEAP_UPPER_BOUND_MB
      value: 64

  # NodeJS Container + Yarn
  - name: node
    image: node:8.11.3-alpine
    tty: true
    resources:
      limits:
        memory: 1536Mi
        cpu: 2
    env:
    - name: POSTGRES_USER
      value: test
    - name: POSTGRES_PASSWORD
      value: test
    - name: POSTGRES_DB
      value: test

  # PostgreSQL for Integration Tests
  - name: postgres
    image: centos/postgresql-96-centos7
    resources:
      limits:
        memory: 256Mi
    env:
    - name: POSTGRESQL_USER
      value: test
    - name: POSTGRESQL_PASSWORD
      value: test
    - name: POSTGRESQL_DATABASE
      value: test
    volumeMounts:
    - name: postgres-data
      mountPath: /var/lib/pgsql/data
    readinessProbe:
      tcpSocket:
        port: 5432
      initialDelaySeconds: 5

  volumes:
  - name: postgres-data
    emptyDir: {}
