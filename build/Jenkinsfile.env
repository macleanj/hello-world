pipeline {
  environment {
    registry = "jmaclean/docker_hub_account/poc-trigger-by-tag"
    registryCredential = 'futurice-jmaclean-docker'
    dockerImage = ''
  }
  agent any
  stages {
    stage ('Process all environment variables') {
      steps {
        sh """
LAST_GIT_BUILD_TAG=$(git tag | sort | egrep "^v-" | tail -1)
LAST_GIT_DEPLOY_TAG=$(git tag | sort | egrep "^d-" | tail -1)

echo "
----- GIT ----- GIT ----- GIT ----- GIT ----- GIT -----
GIT_COMMIT: $GIT_COMMIT
GIT_BRANCH $GIT_BRANCH
GIT_PREVIOUS_COMMIT $GIT_PREVIOUS_COMMIT
GIT_PREVIOUS_SUCCESSFUL_COMMIT $GIT_PREVIOUS_SUCCESSFUL_COMMIT
GIT_URL $GIT_URL
GIT_AUTHOR_NAME $(git show -s --pretty=%an)
GIT_COMMITTER_EMAIL $GIT_COMMITTER_EMAIL

LAST_GIT_BUILD_TAG: $LAST_GIT_BUILD_TAG
LAST_GIT_BUILD_TAG_COMMIT: $(git rev-list -1 $LAST_GIT_BUILD_TAG)
LAST_GIT_DEPLOY_TAG: $LAST_GIT_DEPLOY_TAG
LAST_GIT_DEPLOY_TAG_COMMIT: $(git rev-list -1 $LAST_GIT_DEPLOY_TAG)
" 2>&1 >/dev/null
        """
      }
    }
    }
  }
}
